<template>
    <div v-if="cliente.id">
        <CardComponent size="col-5">
            <h1>Cliente: {{ cliente.nombre + ' ' + cliente.apellidos }}</h1>
            <h6>Meter Informacion del empleaado que le ha dado de alta</h6>
        </CardComponent>
    </div>

    <div v-if="!cliente.id">
        <CardComponent size="col-3">
            <h1 class="text-center">Creaci칩n del Cliente</h1>
        </CardComponent>
    </div>

    <div class="row">
        <div class="col-lg-10">
            <div class="btn-group my-3" role="group">
                <button type="button" class="btn btn-info" @click="cambiarPestania('detalle')">
                    Informaci칩n
                </button>
                <button type="button" class="btn btn-info" @click="cambiarPestania('facturacion')">
                    Datos Facturaci칩n
                </button>
                <button
                    type="button"
                    class="btn btn-info"
                    @click="cambiarPestania('fechaSenialada')"
                >
                    Fechas Se침aladas
                </button>
                <button type="button" class="btn btn-info" @click="cambiarPestania('cuenta_cte')">
                    Cuenta Cte
                </button>
                <button type="button" class="btn btn-info" @click="cambiarPestania('g_Apartado')">
                    G Apartado
                </button>
                <button type="button" class="btn btn-info" @click="cambiarPestania('notas')">
                    Notas
                </button>
                <button
                    v-if="cliente.reparaciones && cliente.reparaciones.length > 0"
                    type="button"
                    class="btn btn-warning"
                    @click="cambiarPestania('reparaciones')"
                >
                    Reparaciones Pendientes
                    <span
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                    >
                        {{ cliente.reparaciones.length }}
                    </span>
                </button>
            </div>
        </div>
        <div class="col">
            <BotonesCrudComponent
                @crear="crear(cliente)"
                @eliminar="eliminar(cliente.id)"
                @modificar="modificar(cliente)"
                :is-cliente="!!cliente.id"
                text="Crear nuevo cliente"
            />
        </div>
    </div>

    <div id="vistas">
        <div class="informacion" v-if="selector == 'detalle'">
            <detalleCliente v-model:cliente="cliente" />
        </div>

        <div class="facturacion" v-if="selector == 'facturacion'">
            <datosFacturacion />
        </div>

        <div class="fechaSenialada" v-if="selector == 'fechaSenialada'">
            <fechasSenialadasCliente />
        </div>

        <div class="cuenta_cte" v-if="selector == 'cuenta_cte'">
            <cuentaCorrienteCliente />
        </div>

        <div class="g_Apartado" v-if="selector == 'g_Apartado'">
            <apartadosCliente />
        </div>

        <div class="notas" v-if="selector == 'notas'">
            <notasCliente />
        </div>

        <div class="reparacion" v-if="selector == 'reparaciones'">
            <reparaciones :cliente_reparaciones="cliente.reparaciones" />
        </div>
        {{ cliente }}
    </div>
</template>

<script setup lang="ts">
import { onMounted } from 'vue';
import { useRoute } from 'vue-router';
import { useCliente } from '@/composables';
import {detalleCliente,datosFacturacion,cuentaCorrienteCliente,fechasSenialadasCliente,apartadosCliente,notasCliente} from '@/components/clientes';
import reparaciones from '@/components/reparaciones/listadoReparacion.vue';
import {CardComponent, BotonesCrudComponent} from '@/components/helpers';

//Estrcuctura Composable
const { selector, cliente, cambiarPestania, detalle, modificar, eliminar, crear, nuevoCliente } =
    useCliente();

const route = useRoute();

onMounted(async () => {
    selector.value = 'detalle';
    try {
        if (route.params.id) {
            detalle(parseInt(route.params.id as string));
        } else {
            nuevoCliente();
        }
    } catch (error) {
        console.log('error en la vista de detalle ERROR: ' + error);
    }
});
</script>
